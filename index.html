<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>ito ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, button { margin: 5px; padding: 8px; }
    .player { margin: 4px 0; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>ito ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</h1>

  <div id="roomCreator">
    <button onclick="createRoom()">éƒ¨å±‹ã‚’ä½œã‚‹</button>
    <div id="roomUrl"></div>
  </div>

  <div id="joinRoom" class="hidden">
    <h3>åå‰ã‚’å…¥åŠ›ã—ã¦å‚åŠ </h3>
    <input id="playerName" placeholder="ã‚ãªãŸã®åå‰">
    <button onclick="join()">å‚åŠ </button>
  </div>

  <div id="gameArea" class="hidden">
    <h2>å‚åŠ è€…ï¼ˆéƒ¨å±‹ã‚³ãƒ¼ãƒ‰: <span id="roomIdDisplay"></span>ï¼‰</h2>
    <div id="playerList"></div>

    <div id="hostArea" class="hidden">
      <h3>ãƒ†ãƒ¼ãƒã‚’è¨­å®š</h3>
      <input id="themeInput" placeholder="ä¾‹ï¼šå¤§ãã•ã€çŸ¥ååº¦ãªã©">
      <button onclick="setTheme()">ãƒ†ãƒ¼ãƒã‚’æ±ºå®š</button>
      <button onclick="startGame()">ğŸ² ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹</button>
    </div>

    <h3>ç¾åœ¨ã®ãƒ†ãƒ¼ãƒ</h3>
    <div id="currentTheme">ï¼ˆã¾ã æœªè¨­å®šï¼‰</div>
  </div>

  <script>
    // Firebaseè¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyBtoNLxqw_TnTSxdNG7gtb308S0jr5pzpE",
      authDomain: "ito-online-4348a.firebaseapp.com",
      databaseURL: "https://ito-online-4348a-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "ito-online-4348a",
      storageBucket: "ito-online-4348a.appspot.com",
      messagingSenderId: "840014772869",
      appId: "1:840014772869:web:8230edfc917d7a393a47ec"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let roomId = "";
    let isHost = false;
    let playerName = "";

    // URLã‹ã‚‰roomIdå–å¾—
    const params = new URLSearchParams(window.location.search);
    if (params.has("room")) {
      roomId = params.get("room");
      document.getElementById("roomCreator").classList.add("hidden");
      document.getElementById("joinRoom").classList.remove("hidden");
    }

    function createRoom() {
      roomId = Math.random().toString(36).substr(2, 6);
      isHost = true;
      const url = `${location.origin}${location.pathname}?room=${roomId}`;
      document.getElementById("roomUrl").innerHTML = `ã“ã®URLã‚’å…±æœ‰ï¼š<br><a href="${url}">${url}</a>`;
      document.getElementById("roomCreator").classList.add("hidden");
      document.getElementById("joinRoom").classList.remove("hidden");
    }

    function join() {
      playerName = document.getElementById("playerName").value;
      if (!playerName) return;
      db.ref(`rooms/${roomId}/players/${playerName}`).set({ joined: true });

      document.getElementById("joinRoom").classList.add("hidden");
      document.getElementById("gameArea").classList.remove("hidden");
      document.getElementById("roomIdDisplay").textContent = roomId;

      if (isHost) {
        document.getElementById("hostArea").classList.remove("hidden");
      }

      watchPlayers();
      watchTheme();
    }

    function watchPlayers() {
      db.ref(`rooms/${roomId}/players`).on("value", snapshot => {
        const players = snapshot.val();
        const list = document.getElementById("playerList");
        list.innerHTML = "";
        for (let name in players) {
          list.innerHTML += `<div class="player">${name}</div>`;
        }
      });
    }

    function setTheme() {
      const theme = document.getElementById("themeInput").value;
      db.ref(`rooms/${roomId}/theme`).set(theme);
    }

    function watchTheme() {
      db.ref(`rooms/${roomId}/theme`).on("value", snapshot => {
        document.getElementById("currentTheme").textContent = snapshot.val() || "ï¼ˆã¾ã æœªè¨­å®šï¼‰";
      });
    }

    function startGame() {
      db.ref(`rooms/${roomId}/status`).set("started");
      alert("ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¾ã—ãŸï¼");
    }
  </script>
</body>
</html>
