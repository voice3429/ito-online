<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>ito ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, button { margin: 5px; padding: 8px; }
    .hidden { display: none; }
    .player { margin: 4px 0; }
  </style>
</head>
<body>
  <h1>ito ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</h1>

  <!-- éƒ¨å±‹ä½œæˆã‚¨ãƒªã‚¢ï¼ˆåˆæœŸè¡¨ç¤ºï¼‰ -->
  <div id="roomCreator">
    <button onclick="createRoom()">éƒ¨å±‹ã‚’ä½œã‚‹</button>
    <div id="roomUrl"></div>
  </div>

  <!-- åå‰å…¥åŠ›ã‚¨ãƒªã‚¢ï¼ˆéƒ¨å±‹å‚åŠ ç”¨ï¼‰ -->
  <div id="joinRoom" class="hidden">
    <h3>éƒ¨å±‹ã‚³ãƒ¼ãƒ‰: <span id="roomIdDisplay"></span></h3>
    <p>åå‰ã‚’å…¥åŠ›ã—ã¦å‚åŠ ã—ã¦ãã ã•ã„</p>
    <input id="playerNameInput" placeholder="ã‚ãªãŸã®åå‰">
    <button onclick="joinRoom()">å‚åŠ </button>
  </div>

  <!-- ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ï¼ˆå‚åŠ å¾Œï¼‰ -->
  <div id="gameArea" class="hidden">
    <h2>å‚åŠ è€…ä¸€è¦§ï¼ˆéƒ¨å±‹ã‚³ãƒ¼ãƒ‰: <span id="roomCodeDisplay"></span>ï¼‰</h2>
    <div id="playerList"></div>
    
    <!-- ãƒ›ã‚¹ãƒˆå°‚ç”¨ã‚¨ãƒªã‚¢ï¼ˆéƒ¨å±‹ä½œæˆè€…ã®ã¿è¡¨ç¤ºï¼‰ -->
    <div id="hostArea" class="hidden">
      <h3>ã‚²ãƒ¼ãƒ ãƒã‚¹ã‚¿ãƒ¼ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h3>
      <p>ãƒ†ãƒ¼ãƒè¨­å®šã¨ã€Œã‚²ãƒ¼ãƒ é–‹å§‹ã€ãƒœã‚¿ãƒ³ã¯ã“ã¡ã‚‰</p>
      <input id="themeInput" placeholder="ä¾‹: å¤§ãã•ã€çŸ¥ååº¦ãªã©">
      <button onclick="setTheme()">ãƒ†ãƒ¼ãƒæ±ºå®š</button>
      <button onclick="startGame()">ğŸ² ã‚²ãƒ¼ãƒ é–‹å§‹</button>
    </div>

    <h3>ç¾åœ¨ã®ãƒ†ãƒ¼ãƒ</h3>
    <div id="currentTheme">ï¼ˆã¾ã æœªè¨­å®šï¼‰</div>
  </div>

  <script>
    // Firebaseæ¥ç¶šè¨­å®šï¼ˆå¿…è¦æƒ…å ±ã«æ›¸ãæ›ãˆæ¸ˆã¿ï¼‰
    const firebaseConfig = {
      apiKey: "AIzaSyBtoNLxqw_TnTSxdNG7gtb308S0jr5pzpE",
      authDomain: "ito-online-4348a.firebaseapp.com",
      databaseURL: "https://ito-online-4348a-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "ito-online-4348a",
      storageBucket: "ito-online-4348a.appspot.com",
      messagingSenderId: "840014772869",
      appId: "1:840014772869:web:8230edfc917d7a393a47ec"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let roomId = "";
    let isHost = false;
    let playerName = "";

    // URLã‚¯ã‚¨ãƒªã‹ã‚‰roomãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆã™ã§ã«éƒ¨å±‹ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
    const params = new URLSearchParams(window.location.search);
    if (params.has("room")) {
      roomId = params.get("room");
      document.getElementById("roomCreator").classList.add("hidden");
      document.getElementById("joinRoom").classList.remove("hidden");
      document.getElementById("roomIdDisplay").textContent = roomId;
    }

    // éƒ¨å±‹ä½œæˆï¼ˆã‚²ãƒ¼ãƒ ãƒã‚¹ã‚¿ãƒ¼ç”¨ï¼‰
    function createRoom() {
      roomId = Math.random().toString(36).substr(2, 6);
      isHost = true;
      const newUrl = `${location.origin}${location.pathname}?room=${roomId}`;
      document.getElementById("roomUrl").innerHTML =
        `éƒ¨å±‹ãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼<br>ã“ã®URLã‚’å…±æœ‰ã—ã¦ãã ã•ã„ï¼š<br><a href="${newUrl}" target="_blank">${newUrl}</a>`;
      document.getElementById("roomCreator").classList.add("hidden");
      document.getElementById("joinRoom").classList.remove("hidden");
      document.getElementById("roomIdDisplay").textContent = roomId;
    }

    // éƒ¨å±‹å‚åŠ å‡¦ç†
    function joinRoom() {
      playerName = document.getElementById("playerNameInput").value;
      if (!playerName) { alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼"); return; }
      db.ref(`rooms/${roomId}/players/${playerName}`).set({ joined: true });
      document.getElementById("joinRoom").classList.add("hidden");
      document.getElementById("gameArea").classList.remove("hidden");
      document.getElementById("roomCodeDisplay").textContent = roomId;
      // ã‚²ãƒ¼ãƒ ãƒã‚¹ã‚¿ãƒ¼ãªã‚‰ãƒ›ã‚¹ãƒˆã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
      if (isHost) {
        document.getElementById("hostArea").classList.remove("hidden");
      }
      watchPlayers();
      watchTheme();
    }

    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‚åŠ è€…ä¸€è¦§ç›£è¦–
    function watchPlayers() {
      db.ref(`rooms/${roomId}/players`).on("value", snapshot => {
        const players = snapshot.val() || {};
        let html = "";
        for (let name in players) {
          html += `<div class="player">${name}</div>`;
        }
        document.getElementById("playerList").innerHTML = html;
      });
    }

    // ãƒ†ãƒ¼ãƒè¨­å®šãƒ»è¡¨ç¤ºå‡¦ç†
    function setTheme() {
      const theme = document.getElementById("themeInput").value;
      db.ref(`rooms/${roomId}/theme`).set(theme);
    }

    function watchTheme() {
      db.ref(`rooms/${roomId}/theme`).on("value", snapshot => {
        document.getElementById("currentTheme").textContent = snapshot.val() || "ï¼ˆã¾ã æœªè¨­å®šï¼‰";
      });
    }

    // ã‚²ãƒ¼ãƒ é–‹å§‹å‡¦ç†ï¼ˆã“ã“ã«ä»»æ„ã®å‡¦ç†ã‚’è¿½åŠ ã§ãã¾ã™ï¼‰
    function startGame() {
      db.ref(`rooms/${roomId}/status`).set("started");
      alert("ã‚²ãƒ¼ãƒ ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸï¼");
    }
  </script>
</body>
</html>
