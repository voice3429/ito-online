<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ito - 部屋主画面</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
  <h1>ito ゲーム - 部屋主</h1>

  <div>
    <p>部屋コード: <span id="roomCode"></span></p>
    <p>テーマ: <input type="text" id="themeInput" placeholder="テーマを入力" /></p>
    <button onclick="startGame()">ゲームを開始</button>
  </div>

  <h2>参加者</h2>
  <ul id="playerList"></ul>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBtoNLxqw_TnTSxdNG7gtb308S0jr5pzpE",
      authDomain: "ito-online-4348a.firebaseapp.com",
      databaseURL: "https://ito-online-4348a-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "ito-online-4348a",
      storageBucket: "ito-online-4348a.appspot.com",
      messagingSenderId: "840014772869",
      appId: "1:840014772869:web:8230edfc917d7a393a47ec"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const params = new URLSearchParams(location.search);
    const roomCode = params.get("room");
    const hostName = params.get("name");

    // 部屋コードと部屋主の名前を表示
    document.getElementById("roomCode").innerText = roomCode;

    const roomRef = db.ref(`rooms/${roomCode}`);
    const playersRef = roomRef.child("players");

    // 部屋のテーマ設定
    const themeInput = document.getElementById("themeInput");
    themeInput.addEventListener("input", function() {
      roomRef.update({
        theme: themeInput.value
      });
    });

    // プレイヤーリストを更新
    playersRef.on("value", snapshot => {
      const playerList = document.getElementById("playerList");
      playerList.innerHTML = ""; // リストをリセット

      snapshot.forEach(playerSnapshot => {
        const player = playerSnapshot.val();
        const li = document.createElement("li");
        li.textContent = playerSnapshot.key;
        playerList.appendChild(li);
      });
    });

    function startGame() {
      if (!themeInput.value) {
        alert("テーマを入力してください！");
        return;
      }

      // ゲーム開始
      roomRef.update({
        status: "started"
      });

      window.location.href = `room.html?room=${roomCode}&name=${encodeURIComponent(hostName)}`;
    }
  </script>
</body>
</html>
